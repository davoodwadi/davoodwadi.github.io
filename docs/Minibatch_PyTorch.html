<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Davood Wadi - MNIST dataset</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Davood Wadi</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html" rel="" target="">
 <span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-courses" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">Courses</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-courses">    
        <li>
    <a class="dropdown-item" href="https://professional.mit.edu/course-catalog/applied-data-science-program-leveraging-ai-effective-decision-making" rel="" target="">
 <span class="dropdown-text">MIT ADSP</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./courses.html" rel="" target="">
 <span class="dropdown-text">MATH60629A</span></a>
  </li>  
    </ul>
  </li>
</ul>
            <div class="quarto-navbar-tools ms-auto">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#datasets-and-dataloaders" id="toc-datasets-and-dataloaders" class="nav-link active" data-scroll-target="#datasets-and-dataloaders">Datasets and dataloaders</a>
  <ul class="collapse">
  <li><a href="#define-the-model" id="toc-define-the-model" class="nav-link" data-scroll-target="#define-the-model">Define the model</a></li>
  </ul></li>
  <li><a href="#training-loop" id="toc-training-loop" class="nav-link" data-scroll-target="#training-loop">Training loop</a>
  <ul class="collapse">
  <li><a href="#fully-connected-layer" id="toc-fully-connected-layer" class="nav-link" data-scroll-target="#fully-connected-layer">Fully Connected layer</a></li>
  </ul></li>
  <li><a href="#convolution-2d" id="toc-convolution-2d" class="nav-link" data-scroll-target="#convolution-2d">Convolution 2D</a></li>
  <li><a href="#cifar-10" id="toc-cifar-10" class="nav-link" data-scroll-target="#cifar-10">Cifar-10</a>
  <ul class="collapse">
  <li><a href="#create-dataset-and-dataloader" id="toc-create-dataset-and-dataloader" class="nav-link" data-scroll-target="#create-dataset-and-dataloader">Create dataset and dataloader</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">MNIST dataset</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<p><a href="https://colab.research.google.com/github/davoodwadi/davoodwadi.github.io/blob/main/Minibatch_PyTorch.ipynb" target="_parent"><img src="https://colab.research.google.com/assets/colab-badge.svg" alt="Open In Colab"></a></p>
<div class="cell" data-outputid="34da537f-a566-4a13-e40c-3ab6d9ec9ffd" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>git clone <span class="st">"https://github.com/davoodwadi/davoodwadi.github.io.git"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Cloning into 'davoodwadi.github.io'...
remote: Enumerating objects: 805, done.
remote: Counting objects: 100% (69/69), done.
remote: Compressing objects: 100% (47/47), done.
remote: Total 805 (delta 31), reused 42 (delta 17), pack-reused 736
Receiving objects: 100% (805/805), 89.88 MiB | 13.12 MiB/s, done.
Resolving deltas: 100% (459/459), done.
Updating files: 100% (244/244), done.</code></pre>
</div>
</div>
<div class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pickle,gzip,math,os,time,shutil,torch,matplotlib <span class="im">as</span> mpl, numpy <span class="im">as</span> np, matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pathlib <span class="im">import</span> Path</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> torch <span class="im">import</span> tensor, nn</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>torch.manual_seed(<span class="dv">42</span>)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>mpl.rcParams[<span class="st">'image.cmap'</span>] <span class="op">=</span> <span class="st">'gray'</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>torch.set_printoptions(precision<span class="op">=</span><span class="dv">2</span>, linewidth<span class="op">=</span><span class="dv">125</span>, sci_mode<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>np.set_printoptions(precision<span class="op">=</span><span class="dv">2</span>, linewidth<span class="op">=</span><span class="dv">125</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>path_data <span class="op">=</span> Path(<span class="st">'./davoodwadi.github.io/data/'</span>)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>path_gz <span class="op">=</span> path_data<span class="op">/</span><span class="st">'mnist.pkl.gz'</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> gzip.<span class="bu">open</span>(path_gz, <span class="st">'rb'</span>) <span class="im">as</span> f: ((x_train, y_train), (x_valid, y_valid), _) <span class="op">=</span> pickle.load(f, encoding<span class="op">=</span><span class="st">'latin-1'</span>)</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>x_train, y_train, x_valid, y_valid <span class="op">=</span> <span class="bu">map</span>(tensor, [x_train, y_train, x_valid, y_valid])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-outputid="aa38ecd4-5243-4fd3-e895-f30ec27b0920" data-execution_count="5">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>x_train.shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="5">
<pre><code>torch.Size([50000, 784])</code></pre>
</div>
</div>
<div class="cell" data-outputid="e150a3c8-9cc2-4ea1-b157-862c0882abb6" data-execution_count="6">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>y_train[<span class="dv">0</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="6">
<pre><code>tensor(5)</code></pre>
</div>
</div>
<div class="cell" data-outputid="3de7c9b4-df88-423b-ac1e-b4512faf86cc" data-execution_count="7">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>i<span class="op">=</span><span class="dv">0</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>plt.imshow(x_train[i].view(<span class="dv">28</span>,<span class="dv">28</span>))</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>plt.title(y_train[i].item())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="7">
<pre><code>Text(0.5, 1.0, '5')</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="Minibatch_PyTorch_files/figure-html/cell-8-output-2.png" class="img-fluid"></p>
</div>
</div>
<section id="datasets-and-dataloaders" class="level1">
<h1>Datasets and dataloaders</h1>
<div class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> torch.utils.data <span class="im">import</span> Dataset, DataLoader</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> dataset(Dataset):</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, x, y):</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>    <span class="va">self</span>.x <span class="op">=</span> x</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>    <span class="va">self</span>.y <span class="op">=</span> y</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>  <span class="kw">def</span> <span class="fu">__len__</span>(<span class="va">self</span>):</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">len</span>(<span class="va">self</span>.x)</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>  <span class="kw">def</span> <span class="fu">__getitem__</span>(<span class="va">self</span>, index):</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="va">self</span>.x[index], <span class="va">self</span>.y[index]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>train_dataset <span class="op">=</span> dataset(x_train, y_train)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>valid_dataset <span class="op">=</span> dataset(x_valid, y_valid)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>x, y <span class="op">=</span> train_dataset[<span class="dv">0</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-outputid="defd856f-9be5-4d88-e224-d6d086cf117e" data-execution_count="12">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>x.shape, y.shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="12">
<pre><code>(torch.Size([784]), torch.Size([]))</code></pre>
</div>
</div>
<div class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>train_loader <span class="op">=</span> DataLoader(train_dataset, batch_size<span class="op">=</span><span class="dv">64</span>, shuffle<span class="op">=</span><span class="va">True</span>, drop_last<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>valid_loader <span class="op">=</span> DataLoader(valid_dataset, batch_size<span class="op">=</span><span class="dv">64</span>, shuffle<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-outputid="3bfc3be9-9b98-4535-8829-284277db1763" data-execution_count="14">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>steps_per_epoch <span class="op">=</span> <span class="bu">len</span>(train_loader)</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'There are </span><span class="sc">{</span>steps_per_epoch<span class="sc">}</span><span class="ss"> steps per epoch'</span>)</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, (xs, ys) <span class="kw">in</span> <span class="bu">enumerate</span>(train_loader):</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> i<span class="op">&gt;</span>(steps_per_epoch<span class="op">-</span><span class="dv">5</span>):</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(xs.shape)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>There are 782 steps per epoch
torch.Size([64, 784])
torch.Size([64, 784])
torch.Size([64, 784])
torch.Size([16, 784])</code></pre>
</div>
</div>
<section id="define-the-model" class="level2">
<h2 class="anchored" data-anchor-id="define-the-model">Define the model</h2>
<div class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> FCModel(nn.Module):</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, feature_size, hidden_size):</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>    <span class="bu">super</span>(FCModel, <span class="va">self</span>).<span class="fu">__init__</span>()</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>    <span class="va">self</span>.fc1 <span class="op">=</span> nn.Linear(feature_size, hidden_size)</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>    <span class="va">self</span>.fc2 <span class="op">=</span> nn.Linear(hidden_size, <span class="dv">10</span>)</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>    <span class="va">self</span>.relu <span class="op">=</span> nn.ReLU()</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>  <span class="kw">def</span> forward(<span class="va">self</span>, x):</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>    out1 <span class="op">=</span> <span class="va">self</span>.fc1(x)</span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>    out2 <span class="op">=</span> <span class="va">self</span>.relu(out1)</span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>    out3 <span class="op">=</span> <span class="va">self</span>.fc2(out2)</span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> out3</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="training-loop" class="level1">
<h1>Training loop</h1>
<div class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>hidden_size <span class="op">=</span> <span class="dv">256</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>lr <span class="op">=</span> <span class="fl">0.01</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> FCModel(x_train.shape[<span class="dv">1</span>], hidden_size)</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>optimizer <span class="op">=</span> torch.optim.SGD(model.parameters(), lr <span class="op">=</span> lr)</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>loss_fn <span class="op">=</span> nn.CrossEntropyLoss()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-outputid="e8f9455f-4053-45a6-a888-fe53fb576eed" data-execution_count="17">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>epoch <span class="op">=</span> <span class="dv">10</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> e <span class="kw">in</span> <span class="bu">range</span>(epoch):</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>  correct <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>  total <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>  losses <span class="op">=</span> []</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># training</span></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>  model.train()</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> bx, by <span class="kw">in</span> train_loader:</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>    output <span class="op">=</span> model(bx)</span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>    loss <span class="op">=</span> loss_fn(output, by)</span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>    loss.backward()</span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>    optimizer.step()</span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a>    optimizer.zero_grad()</span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a>  <span class="co"># validation</span></span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a>  model.<span class="bu">eval</span>()</span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> bx, by <span class="kw">in</span> valid_loader:</span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> torch.no_grad():</span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a>      output <span class="op">=</span> model(bx)</span>
<span id="cb23-21"><a href="#cb23-21" aria-hidden="true" tabindex="-1"></a>    predictions <span class="op">=</span> output.argmax(<span class="op">-</span><span class="dv">1</span>)</span>
<span id="cb23-22"><a href="#cb23-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-23"><a href="#cb23-23" aria-hidden="true" tabindex="-1"></a>    correct <span class="op">+=</span> (predictions<span class="op">==</span>by).<span class="bu">float</span>().<span class="bu">sum</span>()</span>
<span id="cb23-24"><a href="#cb23-24" aria-hidden="true" tabindex="-1"></a>    total <span class="op">+=</span> <span class="bu">len</span>(by)</span>
<span id="cb23-25"><a href="#cb23-25" aria-hidden="true" tabindex="-1"></a>    losses.append(loss.detach().item())</span>
<span id="cb23-26"><a href="#cb23-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-27"><a href="#cb23-27" aria-hidden="true" tabindex="-1"></a>  accuracy <span class="op">=</span> correct<span class="op">/</span>total</span>
<span id="cb23-28"><a href="#cb23-28" aria-hidden="true" tabindex="-1"></a>  <span class="bu">print</span>(<span class="ss">f'epoch </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">; loss </span><span class="sc">{</span>np<span class="sc">.</span>mean(losses)<span class="sc">:.4f}</span><span class="ss">; accuracy </span><span class="sc">{</span>accuracy<span class="sc">:.2f}</span><span class="ss">'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>epoch 0; loss 0.7945; accuracy 0.86
epoch 1; loss 0.4280; accuracy 0.89
epoch 2; loss 0.3679; accuracy 0.90
epoch 3; loss 0.3218; accuracy 0.91
epoch 4; loss 0.6549; accuracy 0.91
epoch 5; loss 0.3248; accuracy 0.92
epoch 6; loss 0.1839; accuracy 0.92
epoch 7; loss 0.1435; accuracy 0.92
epoch 8; loss 0.1725; accuracy 0.93
epoch 9; loss 0.1761; accuracy 0.93</code></pre>
</div>
</div>
<div class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> train_eval(model, optimizer, train_loader, valid_loader, epoch<span class="op">=</span><span class="dv">10</span>):</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> e <span class="kw">in</span> <span class="bu">range</span>(epoch):</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>    correct <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>    total <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>    losses <span class="op">=</span> []</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># training</span></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>    model.train()</span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> bx, by <span class="kw">in</span> train_loader:</span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>      output <span class="op">=</span> model(bx)</span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>      loss <span class="op">=</span> loss_fn(output, by)</span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>      loss.backward()</span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a>      optimizer.step()</span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a>      optimizer.zero_grad()</span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># validation</span></span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a>    model.<span class="bu">eval</span>()</span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> bx, by <span class="kw">in</span> valid_loader:</span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true" tabindex="-1"></a>      <span class="cf">with</span> torch.no_grad():</span>
<span id="cb25-20"><a href="#cb25-20" aria-hidden="true" tabindex="-1"></a>        output <span class="op">=</span> model(bx)</span>
<span id="cb25-21"><a href="#cb25-21" aria-hidden="true" tabindex="-1"></a>      predictions <span class="op">=</span> output.argmax(<span class="op">-</span><span class="dv">1</span>)</span>
<span id="cb25-22"><a href="#cb25-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-23"><a href="#cb25-23" aria-hidden="true" tabindex="-1"></a>      correct <span class="op">+=</span> (predictions<span class="op">==</span>by).<span class="bu">float</span>().<span class="bu">sum</span>()</span>
<span id="cb25-24"><a href="#cb25-24" aria-hidden="true" tabindex="-1"></a>      total <span class="op">+=</span> <span class="bu">len</span>(by)</span>
<span id="cb25-25"><a href="#cb25-25" aria-hidden="true" tabindex="-1"></a>      losses.append(loss.detach().item())</span>
<span id="cb25-26"><a href="#cb25-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-27"><a href="#cb25-27" aria-hidden="true" tabindex="-1"></a>    accuracy <span class="op">=</span> correct<span class="op">/</span>total</span>
<span id="cb25-28"><a href="#cb25-28" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f'epoch </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">; loss </span><span class="sc">{</span>np<span class="sc">.</span>mean(losses)<span class="sc">:.4f}</span><span class="ss">; accuracy </span><span class="sc">{</span>accuracy<span class="sc">:.2f}</span><span class="ss">'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>logits vs.&nbsp;probabilities</p>
<div class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>bx, by <span class="op">=</span> <span class="bu">next</span>(<span class="bu">iter</span>(train_loader))</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> torch.no_grad():</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>  output <span class="op">=</span> model(bx)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-outputid="cca4af7a-3f5a-47da-b181-60028d2e8a09" data-execution_count="20">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>output</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="20">
<pre><code>tensor([[    -3.45,     -6.67,      0.36,     -2.68,      2.19,      3.02,      0.43,     -2.21,      5.08,      2.86],
        [    -4.28,      6.55,      1.62,      0.62,     -3.42,     -0.76,     -0.18,     -0.83,      1.54,     -1.82],
        [    -2.26,      0.37,      2.06,      6.46,     -3.64,     -0.41,     -4.73,     -0.73,      1.68,      0.49],
        [    -7.34,      8.28,     -0.07,      2.95,     -3.40,     -1.12,     -1.31,      0.37,      0.68,      0.12],
        [    -3.02,      0.88,      3.37,      3.36,     -6.88,     -1.84,     -8.78,      4.81,      4.21,      2.75],
        [    -6.52,      7.44,      0.80,      1.00,     -2.73,     -1.87,     -0.89,      0.86,      1.17,     -0.20],
        [    -3.93,     -2.70,     11.14,      4.00,     -5.33,     -3.58,     -0.13,      0.22,      1.83,     -3.07],
        [    -3.87,     -4.26,     -1.61,     -0.33,      5.76,      0.12,     -0.84,     -0.02,      1.36,      3.22],
        [    -5.82,     -5.17,     -3.15,     -2.98,      8.95,      0.35,     -1.90,      1.55,      2.36,      4.67],
        [    -2.05,     -5.05,     -1.39,     -0.76,      6.46,      1.03,     -0.79,     -1.03,      0.45,      2.88],
        [    -2.45,     -3.52,      0.19,     -0.44,      2.43,     -1.90,     -1.64,      2.98,     -0.27,      4.15],
        [    -2.29,     -3.26,      0.11,     -0.03,     -0.14,      0.84,     -1.83,     -3.69,      7.60,      2.07],
        [     1.10,     -6.99,     -2.95,      3.58,     -1.36,     10.39,     -6.36,     -4.24,      4.93,      1.45],
        [    -1.19,     -4.01,      1.25,      3.04,      0.38,      5.65,      0.53,     -6.49,      3.41,     -3.30],
        [    -0.77,     -6.94,      3.12,     -3.87,      5.30,     -5.16,      8.53,     -0.97,     -1.62,      1.19],
        [    -1.17,     -2.19,      0.08,      1.44,     -0.32,      4.68,      2.19,     -4.96,      1.89,     -2.46],
        [    -1.59,     -5.68,      2.90,      3.52,     -2.91,     -1.39,     -7.51,      7.75,      0.31,      3.69],
        [    -3.63,      6.98,      3.16,      0.21,     -3.23,     -0.28,      0.07,     -3.30,      3.65,     -4.42],
        [     5.43,     -8.08,      0.38,     -1.54,     -3.36,      8.93,     -0.93,     -6.97,      5.31,      0.22],
        [    -2.56,     -4.83,      0.50,     -3.18,      6.37,     -1.06,      0.71,      0.23,      1.03,      1.94],
        [    -0.28,     -5.62,     -0.43,      6.83,     -1.63,      2.76,      2.08,     -4.01,      0.48,     -0.39],
        [    -2.93,     -6.40,     -5.57,      1.39,      2.68,      1.17,     -7.30,      6.22,      1.93,      9.28],
        [     1.04,     -8.07,     -0.56,      1.59,      0.03,      8.86,      0.26,     -6.56,      3.29,     -0.38],
        [     1.15,     -4.65,     10.39,      3.57,     -4.78,     -3.91,     -2.35,     -2.16,      1.63,      0.04],
        [    -1.00,     -2.85,      2.42,     -1.88,      0.95,      1.39,      7.18,     -4.93,     -0.06,     -1.75],
        [    -4.32,     -1.79,      0.76,      1.70,     -3.69,      3.76,     -3.66,     -3.83,     10.24,     -0.18],
        [    -6.58,     -0.73,     10.69,      6.01,     -4.13,     -3.05,      1.52,     -4.80,      2.78,     -3.24],
        [    -2.01,     -3.01,      3.21,     -2.59,      1.48,      2.69,      8.63,     -8.60,      2.40,     -3.36],
        [    -3.85,     -5.01,     -0.00,     -4.17,      6.03,     -2.74,     -0.26,      3.20,      1.64,      4.20],
        [    -5.71,     -1.93,     -2.15,     -0.78,      3.09,     -0.62,     -3.43,      1.07,      3.06,      6.69],
        [    -0.70,     -7.12,      2.93,     -5.16,      3.91,     -1.45,     11.43,     -4.76,     -0.32,      0.02],
        [    -3.43,     -5.40,      0.32,     -2.90,      7.44,     -2.65,      1.67,      1.54,     -0.55,      3.22],
        [    -2.74,     -5.66,     -3.01,     -0.29,      6.28,      0.08,      0.53,     -0.14,      1.25,      3.58],
        [    -6.57,     -4.03,     -3.84,      3.58,      1.90,     -0.14,     -5.86,      5.28,      1.74,      7.51],
        [     1.86,     -7.39,      0.70,      1.17,     -2.04,     -1.37,     -4.32,      0.32,      4.42,      6.73],
        [    -5.71,      7.55,      2.25,      0.31,     -1.94,     -1.55,     -1.75,      0.20,      1.98,     -2.48],
        [    10.76,     -8.17,      4.46,      0.22,     -9.75,      6.91,     -0.29,     -4.08,      3.18,     -3.53],
        [    -2.32,     -3.68,      2.09,      2.66,     -0.55,     -0.86,     -3.31,      4.71,     -0.75,      1.59],
        [    -2.49,     -4.34,     -0.60,     -2.31,      0.81,     -1.24,     -4.96,      3.12,      4.45,      6.70],
        [     0.07,     -5.78,     -3.11,      4.17,     -3.13,      6.65,     -3.58,     -1.48,      3.46,      2.52],
        [     0.34,     -4.52,      2.61,     -2.63,      1.01,      2.36,      9.95,     -8.67,      1.86,     -3.23],
        [    -1.93,     -3.45,      2.12,     -3.03,      2.62,      0.52,      7.62,     -2.87,     -0.98,     -1.72],
        [    -2.65,     -3.58,      0.23,     -2.32,      5.71,     -1.82,      0.57,      1.05,     -0.11,      2.19],
        [     9.67,     -9.79,      1.62,      1.59,     -4.74,      3.72,      2.50,     -4.20,      1.28,     -1.55],
        [    -2.48,     -7.55,      5.94,      2.02,     -2.64,     -4.45,     -6.03,      8.06,      1.66,      3.99],
        [    -2.94,     -5.33,     -2.59,     -0.84,      7.74,      0.77,     -0.14,      0.20,      0.08,      2.65],
        [    -3.14,     -5.55,     -1.32,      0.38,      3.51,     -1.27,     -4.19,      1.16,      1.55,      8.52],
        [    -0.03,    -10.42,     -2.67,     -4.14,      8.19,      3.51,      1.41,     -0.05,      1.04,      2.81],
        [    -4.67,      1.13,      1.40,      6.80,     -3.13,     -0.82,     -4.60,      1.38,      0.98,      1.11],
        [    -1.24,     -2.17,     -5.61,      0.34,      4.35,      1.30,     -2.39,      2.18,     -0.27,      3.84],
        [    -1.47,      1.02,     -2.35,     -1.44,     -0.38,      5.56,     -1.30,     -4.94,      7.17,     -2.03],
        [    -2.61,     -5.81,     -1.63,      0.42,      2.62,     -0.65,     -3.92,      2.39,      1.71,      7.26],
        [    -0.12,     -4.88,      1.41,     -0.58,     -3.99,      4.32,     -2.57,     -5.14,     10.83,      0.22],
        [    -1.37,     -5.47,      4.56,      2.84,     -6.61,     -1.88,     -9.47,      8.60,      3.80,      3.67],
        [     2.11,     -4.14,      3.67,      2.51,     -0.49,      1.54,     -0.17,     -3.88,     -0.76,     -0.26],
        [    -2.45,     -0.56,      6.61,      1.49,     -1.62,     -1.35,     -0.44,     -0.94,      1.04,     -2.80],
        [     5.95,     -9.59,     -2.74,      3.33,     -1.34,      2.77,     -2.75,     -0.84,      3.09,      2.55],
        [    -6.23,     -1.99,      1.88,      1.08,      1.40,     -4.67,     -3.71,      7.17,      0.07,      4.22],
        [    -3.79,     -3.19,     -2.18,      1.19,      4.35,     -0.51,     -1.31,      1.81,      0.34,      2.98],
        [    -4.19,     -5.17,     -1.07,     -5.88,     10.69,     -1.81,      3.67,     -0.08,      0.77,      2.21],
        [    -2.76,     -4.65,      1.02,     -1.04,      5.74,     -2.43,      2.01,     -1.14,      0.22,      2.79],
        [    -1.76,     -5.90,     -0.15,      1.40,      0.38,      5.44,     -2.82,     -1.53,      2.19,      2.56],
        [    -4.96,      7.80,      2.36,      0.16,     -3.06,     -1.63,     -0.17,     -1.54,      2.59,     -2.53],
        [    -1.75,     -2.00,     -2.58,      1.22,      0.09,      5.69,      3.35,     -5.94,      2.75,     -1.51]])</code></pre>
</div>
</div>
<section id="fully-connected-layer" class="level2">
<h2 class="anchored" data-anchor-id="fully-connected-layer">Fully Connected layer</h2>
<div class="cell" data-outputid="15bfe69a-d0af-4aa4-e63a-2c0a532a41b4" data-execution_count="21">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>bx.shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="21">
<pre><code>torch.Size([64, 784])</code></pre>
</div>
</div>
<div class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>hidden_size <span class="op">=</span> <span class="dv">256</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>fc <span class="op">=</span> nn.Linear(bx.shape[<span class="dv">1</span>], hidden_size)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-outputid="37b51ad0-b601-4a54-88b3-6b91c169d6ed" data-execution_count="23">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>activation <span class="op">=</span> fc(bx)</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>activation.shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="23">
<pre><code>torch.Size([64, 256])</code></pre>
</div>
</div>
<div class="cell" data-outputid="acc43a79-0e62-4366-9d62-ac066017ed24" data-execution_count="24">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>fc.weight.shape, fc.bias.shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="24">
<pre><code>(torch.Size([256, 784]), torch.Size([256]))</code></pre>
</div>
</div>
<div class="cell" data-outputid="5785f492-5673-4a8e-d230-e8e02efef53f" data-execution_count="25">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>activation_manual <span class="op">=</span> bx <span class="op">@</span> fc.weight.T <span class="op">+</span> fc.bias</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>activation_manual.shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="25">
<pre><code>torch.Size([64, 256])</code></pre>
</div>
</div>
</section>
</section>
<section id="convolution-2d" class="level1">
<h1>Convolution 2D</h1>
<div class="cell" data-execution_count="26">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>bx_3d <span class="op">=</span> bx.view(<span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">28</span>, <span class="dv">28</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="27">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>conv <span class="op">=</span> nn.Conv2d(in_channels<span class="op">=</span><span class="dv">1</span>, out_channels<span class="op">=</span><span class="dv">9</span>, kernel_size<span class="op">=</span>(<span class="dv">3</span>,<span class="dv">3</span>), stride<span class="op">=</span>(<span class="dv">1</span>,<span class="dv">1</span>), padding<span class="op">=</span>(<span class="dv">0</span>,<span class="dv">0</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-outputid="a6ce0f9b-b446-4fff-b348-b508927b2343" data-execution_count="28">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>conv.weight.shape, conv.bias.shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="28">
<pre><code>(torch.Size([9, 1, 3, 3]), torch.Size([9]))</code></pre>
</div>
</div>
<div class="cell" data-outputid="4de9831c-db52-4967-f912-908ddc5ec130" data-execution_count="29">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>activation <span class="op">=</span> conv(bx_3d)</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>activation.shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="29">
<pre><code>torch.Size([64, 9, 26, 26])</code></pre>
</div>
</div>
<div class="cell" data-execution_count="82">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> show_images(activation, channel_first<span class="op">=</span><span class="va">True</span>, title<span class="op">=</span><span class="st">''</span>):</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> channel_first: activation <span class="op">=</span> activation.detach()</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>  fig, axes <span class="op">=</span> plt.subplots(<span class="dv">3</span>,<span class="dv">3</span>)</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> ax, activation <span class="kw">in</span> <span class="bu">zip</span>(axes.flat, activation):</span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>    ax.imshow(activation)</span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>  plt.suptitle(title)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-outputid="8762e894-460d-4c4b-c803-02546e37cf9a" data-execution_count="31">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>plt.imshow(bx[<span class="dv">0</span>].view(<span class="dv">28</span>,<span class="dv">28</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="31">
<pre><code>&lt;matplotlib.image.AxesImage at 0x79d7cab0cbb0&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="Minibatch_PyTorch_files/figure-html/cell-32-output-2.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-outputid="26213fae-c111-42ad-f2e5-bc773a6eda30" data-execution_count="32">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>show_images(activation[<span class="dv">0</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="Minibatch_PyTorch_files/figure-html/cell-33-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="33">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> CNN(nn.Module):</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, features):</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>    <span class="bu">super</span>(CNN, <span class="va">self</span>).<span class="fu">__init__</span>()</span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>    <span class="va">self</span>.conv1 <span class="op">=</span> nn.Conv2d(in_channels<span class="op">=</span><span class="dv">1</span>, out_channels<span class="op">=</span>features, kernel_size<span class="op">=</span>(<span class="dv">3</span>,<span class="dv">3</span>), stride<span class="op">=</span>(<span class="dv">1</span>,<span class="dv">1</span>), padding<span class="op">=</span><span class="st">'same'</span>)</span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>    <span class="va">self</span>.conv2 <span class="op">=</span> nn.Conv2d(in_channels<span class="op">=</span>features, out_channels<span class="op">=</span>features, kernel_size<span class="op">=</span>(<span class="dv">3</span>,<span class="dv">3</span>), stride<span class="op">=</span>(<span class="dv">1</span>,<span class="dv">1</span>), padding<span class="op">=</span><span class="st">'same'</span>)</span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a>    <span class="va">self</span>.activation_fn <span class="op">=</span> nn.ReLU()</span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a>    <span class="va">self</span>.fc <span class="op">=</span> nn.Linear(<span class="dv">28</span><span class="op">*</span><span class="dv">28</span><span class="op">*</span>features, <span class="dv">10</span>)</span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a>  <span class="kw">def</span> forward(<span class="va">self</span>, x):</span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true" tabindex="-1"></a>    out1 <span class="op">=</span> <span class="va">self</span>.conv1(x)</span>
<span id="cb48-12"><a href="#cb48-12" aria-hidden="true" tabindex="-1"></a>    out2 <span class="op">=</span> <span class="va">self</span>.activation_fn(out1)</span>
<span id="cb48-13"><a href="#cb48-13" aria-hidden="true" tabindex="-1"></a>    out3 <span class="op">=</span> <span class="va">self</span>.conv2(out2)</span>
<span id="cb48-14"><a href="#cb48-14" aria-hidden="true" tabindex="-1"></a>    out4 <span class="op">=</span> <span class="va">self</span>.activation_fn(out3)</span>
<span id="cb48-15"><a href="#cb48-15" aria-hidden="true" tabindex="-1"></a>    out4 <span class="op">=</span> out4.view(out3.shape[<span class="dv">0</span>], <span class="op">-</span><span class="dv">1</span>)</span>
<span id="cb48-16"><a href="#cb48-16" aria-hidden="true" tabindex="-1"></a>    out5 <span class="op">=</span> <span class="va">self</span>.fc(out4)</span>
<span id="cb48-17"><a href="#cb48-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> out5</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="34">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>features <span class="op">=</span> <span class="dv">9</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> CNN(features)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="105">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> train_eval(model, optimizer, train_loader<span class="op">=</span>train_loader, valid_loader<span class="op">=</span>valid_loader, epoch<span class="op">=</span><span class="dv">10</span>, dims<span class="op">=</span><span class="dv">3</span>, im_shape <span class="op">=</span> <span class="dv">28</span>, n_channels<span class="op">=</span><span class="dv">1</span>, index<span class="op">=</span><span class="dv">0</span>, display_freq<span class="op">=</span><span class="dv">10</span>):</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>  device <span class="op">=</span> <span class="st">'cuda'</span> <span class="cf">if</span> torch.cuda.is_available() <span class="cf">else</span> <span class="st">'cpu'</span></span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>  model <span class="op">=</span> model.to(device)</span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>  plt.close(<span class="st">'all'</span>)</span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> e <span class="kw">in</span> <span class="bu">range</span>(epoch):</span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a>    correct <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a>    total <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a>    losses <span class="op">=</span> []</span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-10"><a href="#cb50-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># training</span></span>
<span id="cb50-11"><a href="#cb50-11" aria-hidden="true" tabindex="-1"></a>    model.train()</span>
<span id="cb50-12"><a href="#cb50-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> bx, by <span class="kw">in</span> train_loader:</span>
<span id="cb50-13"><a href="#cb50-13" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> dims<span class="op">==</span><span class="dv">3</span>: bx <span class="op">=</span> bx.view(<span class="op">-</span><span class="dv">1</span>, n_channels, im_shape, im_shape)</span>
<span id="cb50-14"><a href="#cb50-14" aria-hidden="true" tabindex="-1"></a>      bx, by <span class="op">=</span> bx.to(device), by.to(device)</span>
<span id="cb50-15"><a href="#cb50-15" aria-hidden="true" tabindex="-1"></a>      output <span class="op">=</span> model(bx)</span>
<span id="cb50-16"><a href="#cb50-16" aria-hidden="true" tabindex="-1"></a>      loss <span class="op">=</span> loss_fn(output, by)</span>
<span id="cb50-17"><a href="#cb50-17" aria-hidden="true" tabindex="-1"></a>      loss.backward()</span>
<span id="cb50-18"><a href="#cb50-18" aria-hidden="true" tabindex="-1"></a>      optimizer.step()</span>
<span id="cb50-19"><a href="#cb50-19" aria-hidden="true" tabindex="-1"></a>      optimizer.zero_grad()</span>
<span id="cb50-20"><a href="#cb50-20" aria-hidden="true" tabindex="-1"></a>      losses.append(loss.detach().item())</span>
<span id="cb50-21"><a href="#cb50-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-22"><a href="#cb50-22" aria-hidden="true" tabindex="-1"></a>    <span class="co"># validation</span></span>
<span id="cb50-23"><a href="#cb50-23" aria-hidden="true" tabindex="-1"></a>    model.<span class="bu">eval</span>()</span>
<span id="cb50-24"><a href="#cb50-24" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> bx, by <span class="kw">in</span> valid_loader:</span>
<span id="cb50-25"><a href="#cb50-25" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> dims<span class="op">==</span><span class="dv">3</span>: bx <span class="op">=</span> bx.view(<span class="op">-</span><span class="dv">1</span>, n_channels, im_shape, im_shape)</span>
<span id="cb50-26"><a href="#cb50-26" aria-hidden="true" tabindex="-1"></a>      bx, by <span class="op">=</span> bx.to(device), by.to(device)</span>
<span id="cb50-27"><a href="#cb50-27" aria-hidden="true" tabindex="-1"></a>      <span class="cf">with</span> torch.no_grad():</span>
<span id="cb50-28"><a href="#cb50-28" aria-hidden="true" tabindex="-1"></a>        output <span class="op">=</span> model(bx)</span>
<span id="cb50-29"><a href="#cb50-29" aria-hidden="true" tabindex="-1"></a>      predictions <span class="op">=</span> output.argmax(<span class="op">-</span><span class="dv">1</span>)</span>
<span id="cb50-30"><a href="#cb50-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-31"><a href="#cb50-31" aria-hidden="true" tabindex="-1"></a>      correct <span class="op">+=</span> (predictions<span class="op">==</span>by).<span class="bu">float</span>().<span class="bu">sum</span>()</span>
<span id="cb50-32"><a href="#cb50-32" aria-hidden="true" tabindex="-1"></a>      total <span class="op">+=</span> <span class="bu">len</span>(by)</span>
<span id="cb50-33"><a href="#cb50-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-34"><a href="#cb50-34" aria-hidden="true" tabindex="-1"></a>    accuracy <span class="op">=</span> correct<span class="op">/</span>total</span>
<span id="cb50-35"><a href="#cb50-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-36"><a href="#cb50-36" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f'epoch </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">; loss </span><span class="sc">{</span>np<span class="sc">.</span>mean(losses)<span class="sc">:.4f}</span><span class="ss">; accuracy </span><span class="sc">{</span>accuracy<span class="sc">:.2f}</span><span class="ss">'</span>)</span>
<span id="cb50-37"><a href="#cb50-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-38"><a href="#cb50-38" aria-hidden="true" tabindex="-1"></a>    img<span class="op">=</span>bx[index]</span>
<span id="cb50-39"><a href="#cb50-39" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> e<span class="op">==</span><span class="dv">0</span>:</span>
<span id="cb50-40"><a href="#cb50-40" aria-hidden="true" tabindex="-1"></a>      fig, ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>,<span class="dv">1</span>)</span>
<span id="cb50-41"><a href="#cb50-41" aria-hidden="true" tabindex="-1"></a>      ax.imshow(bx[index].view(im_shape, im_shape, n_channels).cpu())</span>
<span id="cb50-42"><a href="#cb50-42" aria-hidden="true" tabindex="-1"></a>      ax.set_title(cifar_train.classes[by[index].cpu()])</span>
<span id="cb50-43"><a href="#cb50-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-44"><a href="#cb50-44" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> e<span class="op">%</span>display_freq<span class="op">==</span><span class="dv">0</span>:</span>
<span id="cb50-45"><a href="#cb50-45" aria-hidden="true" tabindex="-1"></a>      <span class="cf">with</span> torch.no_grad():</span>
<span id="cb50-46"><a href="#cb50-46" aria-hidden="true" tabindex="-1"></a>        first_conv_activation <span class="op">=</span> model.conv1(img.view(n_channels, im_shape, im_shape))</span>
<span id="cb50-47"><a href="#cb50-47" aria-hidden="true" tabindex="-1"></a>        show_images(first_conv_activation.cpu(), title<span class="op">=</span><span class="st">'layer 1'</span>)</span>
<span id="cb50-48"><a href="#cb50-48" aria-hidden="true" tabindex="-1"></a>        second_conv_activation <span class="op">=</span> model.conv2(first_conv_activation)</span>
<span id="cb50-49"><a href="#cb50-49" aria-hidden="true" tabindex="-1"></a>        show_images(second_conv_activation.cpu(), title<span class="op">=</span><span class="st">'layer 2'</span>)</span>
<span id="cb50-50"><a href="#cb50-50" aria-hidden="true" tabindex="-1"></a>        third_conv_activation <span class="op">=</span> model.conv3(second_conv_activation)</span>
<span id="cb50-51"><a href="#cb50-51" aria-hidden="true" tabindex="-1"></a>        show_images(third_conv_activation.cpu(), title<span class="op">=</span><span class="st">'layer 3'</span>)</span>
<span id="cb50-52"><a href="#cb50-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-53"><a href="#cb50-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-54"><a href="#cb50-54" aria-hidden="true" tabindex="-1"></a>      plt.pause(<span class="dv">1</span>)</span>
<span id="cb50-55"><a href="#cb50-55" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">'*'</span><span class="op">*</span><span class="dv">20</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="67">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>features <span class="op">=</span> <span class="dv">9</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>lr <span class="op">=</span> <span class="fl">0.001</span></span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> CNN(features)</span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>optimizer <span class="op">=</span> torch.optim.SGD(model.parameters(), lr<span class="op">=</span>lr)</span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a>loss_fn <span class="op">=</span> nn.CrossEntropyLoss()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-outputid="7609f8ba-916b-43f1-f22c-b9f0cb969231" data-execution_count="68">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>train_eval(model, optimizer, dims<span class="op">=</span><span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>RuntimeError: ignored</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>index <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>img <span class="op">=</span> bx[index].view(<span class="dv">1</span>, <span class="dv">28</span>, <span class="dv">28</span>)</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>plt.imshow(img.squeeze())</span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>img.shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>by[<span class="dv">1</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>first_conv_activation <span class="op">=</span> model.conv1(img)</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>first_conv_activation.shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>show_images(first_conv_activation)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>second_conv_activation <span class="op">=</span> model.conv2(first_conv_activation)</span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>second_conv_activation.shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>show_images(second_conv_activation)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="cifar-10" class="level1">
<h1>Cifar-10</h1>
<div class="cell" data-execution_count="39">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> torchvision <span class="im">import</span> datasets</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-outputid="b738aa16-6237-48d3-bb37-a30aff6646ec" data-execution_count="40">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>cifar_train <span class="op">=</span> datasets.CIFAR10(root<span class="op">=</span><span class="st">'./'</span>, train<span class="op">=</span><span class="va">True</span>, download<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>cifar_test <span class="op">=</span> datasets.CIFAR10(root<span class="op">=</span><span class="st">'./'</span>, train<span class="op">=</span><span class="va">False</span>, download<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Downloading https://www.cs.toronto.edu/~kriz/cifar-10-python.tar.gz to ./cifar-10-python.tar.gz
Extracting ./cifar-10-python.tar.gz to ./
Files already downloaded and verified</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>100%|██████████| 170498071/170498071 [00:14&lt;00:00, 12104325.69it/s]</code></pre>
</div>
</div>
<div class="cell" data-outputid="339b4092-0613-4869-976a-8dad19c12e63" data-execution_count="41">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>cifar_train</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="41">
<pre><code>Dataset CIFAR10
    Number of datapoints: 50000
    Root location: ./
    Split: Train</code></pre>
</div>
</div>
<div class="cell" data-outputid="f1ed8d45-4156-4a83-db90-ba7ca90bb0a9" data-execution_count="42">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>x_train <span class="op">=</span> tensor(cifar_train.data)</span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>y_train <span class="op">=</span> tensor(cifar_train.targets)</span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>x_train.shape, y_train.shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="42">
<pre><code>(torch.Size([50000, 32, 32, 3]), torch.Size([50000]))</code></pre>
</div>
</div>
<div class="cell" data-outputid="eecd1cae-3f54-46e6-e67e-01873a921d42" data-execution_count="43">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>x_test <span class="op">=</span> tensor(cifar_test.data)</span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>y_test <span class="op">=</span> tensor(cifar_test.targets)</span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>x_test.shape, y_test.shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="43">
<pre><code>(torch.Size([10000, 32, 32, 3]), torch.Size([10000]))</code></pre>
</div>
</div>
<p>normalize</p>
<div class="cell" data-outputid="4314a7f9-0155-42f7-85a8-482883b25540" data-execution_count="44">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>x_train <span class="op">=</span> x_train<span class="op">/</span><span class="fl">255.</span></span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>x_test <span class="op">=</span> x_test<span class="op">/</span><span class="fl">255.</span></span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a>x_train.dtype</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="44">
<pre><code>torch.float32</code></pre>
</div>
</div>
<section id="create-dataset-and-dataloader" class="level2">
<h2 class="anchored" data-anchor-id="create-dataset-and-dataloader">Create dataset and dataloader</h2>
<div class="cell" data-execution_count="45">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>trainset <span class="op">=</span> dataset(x_train, y_train)</span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>testset <span class="op">=</span> dataset(x_test, y_test)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="46">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>train_loader <span class="op">=</span> DataLoader(trainset, batch_size<span class="op">=</span><span class="dv">64</span>, shuffle<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>valid_loader <span class="op">=</span> DataLoader(testset, batch_size<span class="op">=</span><span class="dv">64</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-outputid="9dc36d25-788f-482c-a29d-6ab80e1a6414" data-execution_count="47">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>cifar_train.classes</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="47">
<pre><code>['airplane',
 'automobile',
 'bird',
 'cat',
 'deer',
 'dog',
 'frog',
 'horse',
 'ship',
 'truck']</code></pre>
</div>
</div>
<div class="cell" data-outputid="feb6d000-9995-4d6b-b3a8-ab84bc8bf9d3" data-execution_count="48">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>index <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>bx, by <span class="op">=</span> <span class="bu">next</span>(<span class="bu">iter</span>(train_loader))</span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a>plt.imshow(bx[index])</span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a>plt.title(cifar_train.classes[by[index]])</span>
<span id="cb76-5"><a href="#cb76-5" aria-hidden="true" tabindex="-1"></a>bx[index].shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="48">
<pre><code>torch.Size([32, 32, 3])</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="Minibatch_PyTorch_files/figure-html/cell-54-output-2.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="130">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> CNN(nn.Module):</span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, features):</span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a>    <span class="bu">super</span>(CNN, <span class="va">self</span>).<span class="fu">__init__</span>()</span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-5"><a href="#cb78-5" aria-hidden="true" tabindex="-1"></a>    <span class="va">self</span>.conv1 <span class="op">=</span> nn.Conv2d(in_channels<span class="op">=</span><span class="dv">3</span>, out_channels<span class="op">=</span>features, kernel_size<span class="op">=</span>(<span class="dv">3</span>,<span class="dv">3</span>), stride<span class="op">=</span>(<span class="dv">1</span>,<span class="dv">1</span>), padding<span class="op">=</span><span class="st">'same'</span>)</span>
<span id="cb78-6"><a href="#cb78-6" aria-hidden="true" tabindex="-1"></a>    <span class="va">self</span>.conv2 <span class="op">=</span> nn.Conv2d(in_channels<span class="op">=</span>features, out_channels<span class="op">=</span>features<span class="op">*</span><span class="dv">2</span>, kernel_size<span class="op">=</span>(<span class="dv">3</span>,<span class="dv">3</span>), stride<span class="op">=</span>(<span class="dv">1</span>,<span class="dv">1</span>), padding<span class="op">=</span><span class="st">'same'</span>)</span>
<span id="cb78-7"><a href="#cb78-7" aria-hidden="true" tabindex="-1"></a>    <span class="va">self</span>.conv3 <span class="op">=</span> nn.Conv2d(in_channels<span class="op">=</span>features<span class="op">*</span><span class="dv">2</span>, out_channels<span class="op">=</span>features<span class="op">*</span><span class="dv">4</span>, kernel_size<span class="op">=</span>(<span class="dv">3</span>,<span class="dv">3</span>), stride<span class="op">=</span>(<span class="dv">1</span>,<span class="dv">1</span>), padding<span class="op">=</span><span class="st">'same'</span>)</span>
<span id="cb78-8"><a href="#cb78-8" aria-hidden="true" tabindex="-1"></a>    <span class="va">self</span>.activation_fn <span class="op">=</span> nn.ReLU()</span>
<span id="cb78-9"><a href="#cb78-9" aria-hidden="true" tabindex="-1"></a>    <span class="va">self</span>.pooling <span class="op">=</span> nn.MaxPool2d((<span class="dv">2</span>, <span class="dv">2</span>))</span>
<span id="cb78-10"><a href="#cb78-10" aria-hidden="true" tabindex="-1"></a>    <span class="va">self</span>.global_pooling <span class="op">=</span> nn.AdaptiveAvgPool2d()</span>
<span id="cb78-11"><a href="#cb78-11" aria-hidden="true" tabindex="-1"></a>    <span class="va">self</span>.fc <span class="op">=</span> nn.Linear(features<span class="op">*</span><span class="dv">4</span>, <span class="dv">10</span>)</span>
<span id="cb78-12"><a href="#cb78-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-13"><a href="#cb78-13" aria-hidden="true" tabindex="-1"></a>  <span class="kw">def</span> forward(<span class="va">self</span>, x):</span>
<span id="cb78-14"><a href="#cb78-14" aria-hidden="true" tabindex="-1"></a>    out <span class="op">=</span> <span class="va">self</span>.conv1(x)</span>
<span id="cb78-15"><a href="#cb78-15" aria-hidden="true" tabindex="-1"></a>    out <span class="op">=</span> <span class="va">self</span>.activation_fn(out)</span>
<span id="cb78-16"><a href="#cb78-16" aria-hidden="true" tabindex="-1"></a>    out <span class="op">=</span> <span class="va">self</span>.pooling(out)</span>
<span id="cb78-17"><a href="#cb78-17" aria-hidden="true" tabindex="-1"></a>    out <span class="op">=</span> <span class="va">self</span>.conv2(out)</span>
<span id="cb78-18"><a href="#cb78-18" aria-hidden="true" tabindex="-1"></a>    out <span class="op">=</span> <span class="va">self</span>.activation_fn(out)</span>
<span id="cb78-19"><a href="#cb78-19" aria-hidden="true" tabindex="-1"></a>    out <span class="op">=</span> <span class="va">self</span>.pooling(out)</span>
<span id="cb78-20"><a href="#cb78-20" aria-hidden="true" tabindex="-1"></a>    out <span class="op">=</span> <span class="va">self</span>.conv3(out)</span>
<span id="cb78-21"><a href="#cb78-21" aria-hidden="true" tabindex="-1"></a>    out <span class="op">=</span> <span class="va">self</span>.activation_fn(out)</span>
<span id="cb78-22"><a href="#cb78-22" aria-hidden="true" tabindex="-1"></a>    out <span class="op">=</span> <span class="va">self</span>.global_pooling(out)</span>
<span id="cb78-23"><a href="#cb78-23" aria-hidden="true" tabindex="-1"></a>    out <span class="op">=</span> out.view(out.shape[<span class="dv">0</span>], <span class="op">-</span><span class="dv">1</span>)</span>
<span id="cb78-24"><a href="#cb78-24" aria-hidden="true" tabindex="-1"></a>    out <span class="op">=</span> <span class="va">self</span>.fc(out)</span>
<span id="cb78-25"><a href="#cb78-25" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> out</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-outputid="fe3da6e2-f0e6-4e5f-c547-42ad115b5aab" data-execution_count="131">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>features <span class="op">=</span> <span class="dv">8</span></span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a>lr <span class="op">=</span> <span class="fl">0.001</span></span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a>epochs <span class="op">=</span> <span class="dv">100</span></span>
<span id="cb79-4"><a href="#cb79-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-5"><a href="#cb79-5" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> CNN(features)</span>
<span id="cb79-6"><a href="#cb79-6" aria-hidden="true" tabindex="-1"></a>optimizer <span class="op">=</span> torch.optim.AdamW(model.parameters(), lr)</span>
<span id="cb79-7"><a href="#cb79-7" aria-hidden="true" tabindex="-1"></a>loss_fn <span class="op">=</span> nn.CrossEntropyLoss()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>TypeError: ignored</code></pre>
</div>
</div>
<div class="cell" data-outputid="f5bfa747-f908-492b-88f7-b1006d849da8" data-execution_count="132">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>train_eval(model, optimizer, train_loader, valid_loader, im_shape<span class="op">=</span><span class="dv">32</span>, n_channels<span class="op">=</span><span class="dv">3</span>, epoch<span class="op">=</span>epochs, display_freq<span class="op">=</span><span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>epoch 0; loss 1.2450; accuracy 0.49
********************
epoch 1; loss 1.2443; accuracy 0.48
********************
epoch 2; loss 1.2408; accuracy 0.49
********************
epoch 3; loss 1.2400; accuracy 0.49
********************
epoch 4; loss 1.2362; accuracy 0.49
********************
epoch 5; loss 1.2355; accuracy 0.50
********************
epoch 6; loss 1.2315; accuracy 0.50
********************
epoch 7; loss 1.2293; accuracy 0.50
********************
epoch 8; loss 1.2254; accuracy 0.50
********************
epoch 9; loss 1.2242; accuracy 0.50
********************
epoch 10; loss 1.2188; accuracy 0.49
********************
epoch 11; loss 1.2236; accuracy 0.49
********************
epoch 12; loss 1.2185; accuracy 0.50
********************
epoch 13; loss 1.2158; accuracy 0.49
********************
epoch 14; loss 1.2105; accuracy 0.50
********************
epoch 15; loss 1.2142; accuracy 0.50
********************
epoch 16; loss 1.2112; accuracy 0.49
********************
epoch 17; loss 1.2078; accuracy 0.49
********************
epoch 18; loss 1.2036; accuracy 0.49
********************
epoch 19; loss 1.2043; accuracy 0.50
********************
epoch 20; loss 1.2057; accuracy 0.50
********************
epoch 21; loss 1.2014; accuracy 0.50
********************
epoch 22; loss 1.1988; accuracy 0.50
********************
epoch 23; loss 1.2005; accuracy 0.50
********************
epoch 24; loss 1.1956; accuracy 0.49
********************
epoch 25; loss 1.1943; accuracy 0.49
********************
epoch 26; loss 1.1931; accuracy 0.50
********************
epoch 27; loss 1.1945; accuracy 0.49
********************
epoch 28; loss 1.1922; accuracy 0.50
********************
epoch 29; loss 1.1891; accuracy 0.50
********************
epoch 30; loss 1.1911; accuracy 0.50
********************
epoch 31; loss 1.1864; accuracy 0.49
********************
epoch 32; loss 1.1842; accuracy 0.50
********************
epoch 33; loss 1.1858; accuracy 0.50
********************
epoch 34; loss 1.1837; accuracy 0.50
********************
epoch 35; loss 1.1837; accuracy 0.50
********************
epoch 36; loss 1.1831; accuracy 0.49
********************
epoch 37; loss 1.1818; accuracy 0.49
********************
epoch 38; loss 1.1815; accuracy 0.50
********************
epoch 39; loss 1.1793; accuracy 0.49
********************
epoch 40; loss 1.1748; accuracy 0.50
********************
epoch 41; loss 1.1751; accuracy 0.49
********************
epoch 42; loss 1.1773; accuracy 0.50
********************
epoch 43; loss 1.1748; accuracy 0.50
********************
epoch 44; loss 1.1737; accuracy 0.50
********************
epoch 45; loss 1.1706; accuracy 0.50
********************
epoch 46; loss 1.1731; accuracy 0.51
********************
epoch 47; loss 1.1669; accuracy 0.50
********************
epoch 48; loss 1.1720; accuracy 0.50
********************
epoch 49; loss 1.1657; accuracy 0.50
********************
epoch 50; loss 1.1687; accuracy 0.51
********************
epoch 51; loss 1.1663; accuracy 0.50
********************
epoch 52; loss 1.1666; accuracy 0.50
********************
epoch 53; loss 1.1655; accuracy 0.50
********************
epoch 54; loss 1.1634; accuracy 0.49
********************
epoch 55; loss 1.1648; accuracy 0.50
********************
epoch 56; loss 1.1619; accuracy 0.50
********************
epoch 57; loss 1.1613; accuracy 0.50
********************
epoch 58; loss 1.1614; accuracy 0.51
********************
epoch 59; loss 1.1615; accuracy 0.50
********************
epoch 60; loss 1.1541; accuracy 0.50
********************
epoch 61; loss 1.1559; accuracy 0.50
********************
epoch 62; loss 1.1574; accuracy 0.50
********************
epoch 63; loss 1.1555; accuracy 0.50
********************
epoch 64; loss 1.1575; accuracy 0.49
********************
epoch 65; loss 1.1580; accuracy 0.50
********************
epoch 66; loss 1.1594; accuracy 0.50
********************
epoch 67; loss 1.1529; accuracy 0.51
********************
epoch 68; loss 1.1565; accuracy 0.50
********************
epoch 69; loss 1.1536; accuracy 0.50
********************
epoch 70; loss 1.1511; accuracy 0.51
********************
epoch 71; loss 1.1517; accuracy 0.50
********************
epoch 72; loss 1.1473; accuracy 0.50
********************
epoch 73; loss 1.1529; accuracy 0.50
********************
epoch 74; loss 1.1502; accuracy 0.50
********************
epoch 75; loss 1.1526; accuracy 0.51
********************
epoch 76; loss 1.1487; accuracy 0.51
********************
epoch 77; loss 1.1517; accuracy 0.50
********************
epoch 78; loss 1.1458; accuracy 0.50
********************
epoch 79; loss 1.1505; accuracy 0.50
********************
epoch 80; loss 1.1497; accuracy 0.50
********************
epoch 81; loss 1.1479; accuracy 0.50
********************
epoch 82; loss 1.1457; accuracy 0.50
********************
epoch 83; loss 1.1487; accuracy 0.51
********************
epoch 84; loss 1.1455; accuracy 0.50
********************
epoch 85; loss 1.1448; accuracy 0.51
********************
epoch 86; loss 1.1437; accuracy 0.51
********************
epoch 87; loss 1.1436; accuracy 0.50
********************
epoch 88; loss 1.1425; accuracy 0.49
********************
epoch 89; loss 1.1411; accuracy 0.51
********************
epoch 90; loss 1.1440; accuracy 0.50
********************
epoch 91; loss 1.1404; accuracy 0.50
********************
epoch 92; loss 1.1421; accuracy 0.50
********************
epoch 93; loss 1.1427; accuracy 0.50
********************
epoch 94; loss 1.1384; accuracy 0.51
********************
epoch 95; loss 1.1390; accuracy 0.50
********************
epoch 96; loss 1.1395; accuracy 0.51
********************
epoch 97; loss 1.1397; accuracy 0.51
********************
epoch 98; loss 1.1410; accuracy 0.50
********************
epoch 99; loss 1.1402; accuracy 0.50
********************</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="Minibatch_PyTorch_files/figure-html/cell-57-output-2.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="Minibatch_PyTorch_files/figure-html/cell-57-output-3.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="Minibatch_PyTorch_files/figure-html/cell-57-output-4.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="Minibatch_PyTorch_files/figure-html/cell-57-output-5.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="Minibatch_PyTorch_files/figure-html/cell-57-output-6.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="Minibatch_PyTorch_files/figure-html/cell-57-output-7.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="Minibatch_PyTorch_files/figure-html/cell-57-output-8.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="Minibatch_PyTorch_files/figure-html/cell-57-output-9.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="Minibatch_PyTorch_files/figure-html/cell-57-output-10.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="Minibatch_PyTorch_files/figure-html/cell-57-output-11.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="Minibatch_PyTorch_files/figure-html/cell-57-output-12.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="Minibatch_PyTorch_files/figure-html/cell-57-output-13.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="Minibatch_PyTorch_files/figure-html/cell-57-output-14.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="Minibatch_PyTorch_files/figure-html/cell-57-output-15.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="Minibatch_PyTorch_files/figure-html/cell-57-output-16.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="Minibatch_PyTorch_files/figure-html/cell-57-output-17.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="Minibatch_PyTorch_files/figure-html/cell-57-output-18.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="Minibatch_PyTorch_files/figure-html/cell-57-output-19.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="Minibatch_PyTorch_files/figure-html/cell-57-output-20.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="Minibatch_PyTorch_files/figure-html/cell-57-output-21.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="Minibatch_PyTorch_files/figure-html/cell-57-output-22.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="Minibatch_PyTorch_files/figure-html/cell-57-output-23.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="Minibatch_PyTorch_files/figure-html/cell-57-output-24.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="Minibatch_PyTorch_files/figure-html/cell-57-output-25.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="Minibatch_PyTorch_files/figure-html/cell-57-output-26.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="Minibatch_PyTorch_files/figure-html/cell-57-output-27.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="Minibatch_PyTorch_files/figure-html/cell-57-output-28.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="Minibatch_PyTorch_files/figure-html/cell-57-output-29.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="Minibatch_PyTorch_files/figure-html/cell-57-output-30.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="Minibatch_PyTorch_files/figure-html/cell-57-output-31.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="Minibatch_PyTorch_files/figure-html/cell-57-output-32.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-outputid="1af39f7f-a1f7-4e9c-8ef2-7e6c5b413184" data-execution_count="133">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a>index <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a>img<span class="op">=</span>bx[index]</span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a>plt.imshow(bx[index])</span>
<span id="cb83-4"><a href="#cb83-4" aria-hidden="true" tabindex="-1"></a>plt.title(cifar_train.classes[by[index]])</span>
<span id="cb83-5"><a href="#cb83-5" aria-hidden="true" tabindex="-1"></a>bx[index].shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="133">
<pre><code>torch.Size([32, 32, 3])</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="Minibatch_PyTorch_files/figure-html/cell-58-output-2.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-outputid="2a808e68-6829-4713-d4f5-d5b7cb79ad03" data-execution_count="134">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a>first_conv_activation <span class="op">=</span> model.conv1(img.view(<span class="dv">3</span>, <span class="dv">32</span>, <span class="dv">32</span>).cuda())</span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a>show_images(first_conv_activation.cpu())</span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a>first_conv_activation.shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="134">
<pre><code>torch.Size([8, 32, 32])</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="Minibatch_PyTorch_files/figure-html/cell-59-output-2.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-outputid="1b0ed5a9-0968-427f-ff1c-f3b92e93fc45" data-execution_count="135">
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a>second_conv_activation <span class="op">=</span> model.conv2(first_conv_activation.cuda())</span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a>show_images(second_conv_activation.cpu())</span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a>second_conv_activation.shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="135">
<pre><code>torch.Size([16, 32, 32])</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="Minibatch_PyTorch_files/figure-html/cell-60-output-2.png" class="img-fluid"></p>
</div>
</div>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>